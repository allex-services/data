!function(a,b,c){}(angular.module("allex.data",["allex.lib","ui.grid","ui.grid.autoResize"]),ALLEX.lib,ALLEX),function(a,b,c){a.directive("allexDataView",["$parse","allex.lib.UserDependentMixIn",function(a,c){function d(a){b.BasicController.call(this,a),this.el=null,this.config=null,this.name=null,this.sink_name=null,this.data=null,this.viewType=null,this._monitorForGui=null,this._is_remote=null,this.recordDescriptor=null,c.call(this,a)}return b.inherit(d,b.BasicController),c.addMethods(d),d.prototype.__cleanUp=function(){this._forgetSink(),this.sink_name=null,this.name=null,this.el=null,this.config=null,this.data=null,this.viewType=null,this.recordDescriptor=null,c.prototype.__cleanUp.call(this),b.BasicController.prototype.__cleanUp.call(this)},d.prototype._fetchSink=function(){var a=this.get("user");this.get("sink_name")&&"loggedin"===a.get("state")&&this.set("sinkRepresentation",this.get("user").getSubSink(this.sink_name))},d.prototype._forgetSink=function(){this._is_remote,this._is_remote=null,this._monitorForGui&&this._monitorForGui.destroy(),this._monitorForGui=null},d.prototype.set_sinkRepresentation=function(a){this._forgetSink();var b=this.get("user");console.log(this.sink_name,a),a&&(this._is_remote=b.isSinkRemote(this.sink_name),this._is_remote&&b.execute("askForRemote",this.sink_name).done(this._got_sinkReady.bind(this,a),this._failed.bind(this)),this._got_sinkReady(a))},d.prototype._failed=function(){console.log("DJE BA ZAPELO?",arguments)},d.prototype._got_sinkReady=function(a){this.set("data",a.data),this._monitorForGui=a.monitorDataForGui(this._updateCB.bind(this)),this.set("recordDescriptor",a.sink.recordDescriptor)},d.prototype.set_recordDescriptor=function(a){this.recordDescriptor=a},d.prototype._updateCB=function(){this.$apply()},d.prototype.set_userState=function(a){c.prototype.set_userState.call(this,a),this._fetchSink()},d.prototype.set_sink_name=function(a){this.sink_name=a,this._fetchSink()},d.prototype.configure=function(a){if(!ALLEX_CONFIGURATION.VIEWS)throw new Error("No views configuration");if(!ALLEX_CONFIGURATION.VIEWS[a.sink])throw new Error("No view configuration for sink "+a.sink);if(!ALLEX_CONFIGURATION.VIEWS[a.sink][a.name])throw new Error("No view configuration for view "+a.name);var b=ALLEX_CONFIGURATION.VIEWS[a.sink][a.name];this.set("viewType",b.view),this.set("config",b.config),this.name=b.name,this.set("sink_name",a.sink)},{restrict:"E",replace:!0,scope:!0,templateUrl:"partials/allex_dataservice/partials/dataview.html",controller:d,link:function(b,c,d){b._ctrl.set("el",c),b._ctrl.configure(a(d.config)(b))}}}])}(angular.module("allex.data"),ALLEX.lib,ALLEX),function(a,b,c){a.directive("allexDataSetitem",["$parse",function(a){return{restrict:"A",scope:!1,link:function(b,c,d){b._ctrl.set("item",a(d.allexDataSetitem)(b))}}}])}(angular.module("allex.data"),ALLEX.lib,ALLEX),function(a,b,c){a.directive("allexDataGrid",["allex.lib.interfaces","$compile",function(a,c){function d(c){b.BasicController.call(this,c),a.Element.call(this),this._parent=c.$parent._ctrl,this._record_descriptor_l=null}return b.inherit(d,b.BasicController),a.Element.addMethods(d),d.prototype.__cleanUp=function(){this._record_descriptor_l.destroy(),this._record_descriptor_l=null,this._parent=null,a.prototype.__cleanUp.call(this),b.BasicController.prototype.__cleanUp.call(this)},d.prototype.get_data=function(){return this._parent.get("data")},d.prototype.build=function(){this._parent.attachListener("recordDescriptor",this.set.bind(this,"recordDescriptor"))},d.prototype.releaseGrid=function(){this.get("el").empty()},d.prototype.set_recordDescriptor=function(a){if(this.releaseGrid(),a){var b=this._parent.get("config");this.gridOptions=this.prepareGridOptions(a),this.gridOptions.data=this._parent.get("data");var d=$("<div>").addClass("allex_grid").attr("data-ui-grid","_ctrl.gridOptions");b.autoresize&&d.attr("ui-grid-auto-resize","");var e=this.get("el");e.append(d),e.removeClass(),e.addClass("allex_grid_container"),b.container_class&&e.addClass(b.container_class),b.grid_class&&d.addClass(b.grid_class),c(this.get("el").contents())(this.scope)}},d.prototype.prepareGridOptions=function(a){var b=angular.extend({},this._parent.get("config").grid),c=b.columnDefs;return b.columnDefs=a.fields.map(this._buildColumnDef.bind(this,c)),b},d.prototype._buildColumnDef=function(a,b){return angular.extend(a[b.name]||{},{displayName:b.title,field:b.name})},{restrict:"E",replace:!0,scope:!0,transclude:!0,controller:d,template:'<div class="allex_grid_container"></div>',link:function(a,b,c){a._ctrl.set("el",b)}}}])}(angular.module("allex.data"),ALLEX.lib,ALLEX),function(a,b,c){var d={no_item:"<strong>Items unavailable</strong>"};a.directive("allexDataList",["$compile",function(a){return{restrict:"E",scope:!1,transclude:!0,template:'<div class="allex_data_list"><div class="empty" data-ng-hide="_ctrl.data.length"></div><ul class="allex_data_list" data-ng-show="_ctrl.data.length"></ul></div>',replace:!0,link:function(b,c,e){var f=b._ctrl.get("config"),g="$litem in _ctrl.data";f.track&&(g+=" track by "+f.track),f.orderBy&&(g+=" | orderBy:'"+f.orderBy+"'"),f.limitTo;var h=f.item,i=$("<li>"+f.item.content+"</li>");i.attr({"data-ng-repeat":g}),i.attr(h.attrs),f.filter&&i.attr({"data-ng-if":f.filter}),f.list&&f.list.attrs&&c.find("ul").attr(f.list.attrs),c.find("ul").append(i),c.find("div.empty").append(f.empty?f.empty:d.no_item),a(c.contents())(b)}}}])}(angular.module("allex.data"),ALLEX.lib,ALLEX),function(a,b,c){a.directive("allexDataCrudView",["$compile","allex.AllexViewChild",function(a,c){function d(a){b.BasicController.call(this,a),c.call(this,a),this.config=this.get("data")}return b.inherit(d,b.BasicController),c.addMethods(d),d.prototype.__cleanUp=function(){this.config=null,c.prototype.__cleanUp.call(this),b.BasicController.prototype.__cleanUp.call(this)},{restrict:"E",scope:!1,transclude:!0,controller:d,replace:!0,template:'<div class="crudview"></div>',link:function(b,c){var d=$("<allex-data-view>");d.attr("data-config",JSON.stringify(b._ctrl.config)),c.append(d),a(c.contents())(b)}}}])}(angular.module("allex.data"),ALLEX.lib,ALLEX);